// Prisma schema for Meeting Intelligence SaaS
// Docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum SubscriptionTier {
  FREE
  PRO
  ENTERPRISE
}

enum MeetingStatus {
  SCHEDULED
  IN_PROGRESS
  PROCESSING
  COMPLETED
  FAILED
}

enum SentimentType {
  POSITIVE
  NEUTRAL
  NEGATIVE
  MIXED
}

model User {
  id               String           @id @default(cuid())
  clerkId          String           @unique
  email            String           @unique
  name             String?
  subscriptionTier SubscriptionTier @default(FREE)
  
  // Stripe billing
  stripeCustomerId  String?  @unique
  stripePriceId     String?
  stripeSubscriptionId String?
  
  // Usage tracking
  usageMinutes      Int      @default(0)  // Minutes used this billing cycle
  billingCycleStart DateTime?
  
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  meetings Meeting[]

  @@index([clerkId])
  @@index([email])
  @@index([stripeCustomerId])
}

model Meeting {
  id            String        @id @default(cuid())
  userId        String
  title         String
  status        MeetingStatus @default(SCHEDULED)
  transcript    String?       @db.Text
  audioUrls     String[]
  duration      Int?          // Duration in seconds
  summary       String?       @db.Text
  actionItems   Json?         // Array of action items
  sentiment     SentimentType?
  followUpEmail String?       @db.Text
  startedAt     DateTime?
  endedAt       DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}
